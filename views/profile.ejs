<%- include('partials/header') %>

<section class="card">
  <h2 style="text-align:center" data-translate="yourProfile">आपकी प्रोफ़ाइल</h2>

  <table class="profile-table">
    <tr><th data-translate="name">नाम</th><td><%= resident.name %></td></tr>
    <tr><th data-translate="mobile">मोबाइल नंबर</th><td><%= resident.mobile %></td></tr>
    <tr><th data-translate="email">ईमेल</th><td><%= resident.email %></td></tr>
    <tr><th data-translate="aadhaar">आधार</th><td><%= resident.aadhaar %></td></tr>
    <tr><th data-translate="fatherHusbandName">पिता/पति का नाम</th><td><%= resident.fatherName || '-' %></td></tr>
    <tr><th data-translate="fatherHusbandMobile">पिता/पति का मोबाइल</th><td><%= resident.fatherMobile || '-' %></td></tr>
    <tr><th data-translate="ward">वार्ड</th><td><%= resident.ward || '-' %></td></tr>
    <tr><th data-translate="panchayat">पंचायत</th><td><%= resident.panchayat %></td></tr>
    <tr><th data-translate="village">गाँव</th><td><%= resident.village || '-' %></td></tr>
  </table>

  <div style="text-align:center; margin-top:12px;">
    <a class="btn" href="/enter-details" data-translate="editDetails">विवरण संपादित करें</a>
    <a class="btn outline" href="/logout" data-translate="logout">लॉगआउट</a>
  </div>

  <!-- Delete Account Section -->
  <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e74c3c; text-align: center;">
    <h3 style="color: #e74c3c; margin-bottom: 10px;" data-translate="dangerZone">⚠️ खतरा क्षेत्र</h3>
    <p style="color: #666; margin-bottom: 15px;" data-translate="deleteWarning">
      ⚠️ चेतावनी: यह क्रिया पूर्ववत नहीं की जा सकती!
    </p>
    <button id="deleteAccountBtn" class="btn" style="background: #e74c3c; border-color: #e74c3c;" data-translate="deleteAccount">
      मेरा खाता स्थायी रूप से हटाएं
    </button>
  </div>
</section>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
  <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; text-align: center;">
    <h2 style="color: #e74c3c; margin-bottom: 20px;" data-translate="deleteAccount">मेरा खाता स्थायी रूप से हटाएं</h2>
    <p style="margin-bottom: 20px; color: #333;" data-translate="confirmDelete">
      क्या आप वाकई अपना खाता हटाना चाहते हैं?
    </p>
    <div style="display: flex; gap: 10px; justify-content: center;">
      <button id="confirmDelete" class="btn" style="background: #e74c3c; border-color: #e74c3c;" data-translate="yesDelete">
        हाँ, हटाएं
      </button>
      <button id="cancelDelete" class="btn outline" data-translate="noCancel">नहीं, रद्द करें</button>
    </div>
  </div>
</div>

<script>
  // Delete Account Functionality
  const deleteBtn = document.getElementById('deleteAccountBtn');
  const deleteModal = document.getElementById('deleteModal');
  const confirmBtn = document.getElementById('confirmDelete');
  const cancelBtn = document.getElementById('cancelDelete');

  deleteBtn.addEventListener('click', () => {
    deleteModal.style.display = 'flex';
  });

  cancelBtn.addEventListener('click', () => {
    deleteModal.style.display = 'none';
  });

  confirmBtn.addEventListener('click', async () => {
    try {
      const res = await fetch('/delete-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      
      const data = await res.json();
      
      if (data.success) {
        alert('Your account has been deleted successfully.');
        window.location.href = '/';
      } else {
        alert(data.error || 'Failed to delete account');
      }
    } catch (err) {
      alert('Error deleting account. Please try again.');
    }
  });
</script>

<%- include('partials/footer') %>
